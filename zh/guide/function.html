<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>内置函数 | CellReport</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/CellReport/logo.jpg">
    <meta name="description" content="我的个人网站">
    
    <link rel="preload" href="/CellReport/assets/css/0.styles.91d50dc1.css" as="style"><link rel="preload" href="/CellReport/assets/js/app.17a3e785.js" as="script"><link rel="preload" href="/CellReport/assets/js/2.5bae9e2d.js" as="script"><link rel="preload" href="/CellReport/assets/js/1.6b473380.js" as="script"><link rel="preload" href="/CellReport/assets/js/30.ae59d942.js" as="script"><link rel="prefetch" href="/CellReport/assets/js/10.5d0c9869.js"><link rel="prefetch" href="/CellReport/assets/js/11.ed9759c5.js"><link rel="prefetch" href="/CellReport/assets/js/12.13686169.js"><link rel="prefetch" href="/CellReport/assets/js/13.58661524.js"><link rel="prefetch" href="/CellReport/assets/js/14.0ca0c540.js"><link rel="prefetch" href="/CellReport/assets/js/15.3eee5f97.js"><link rel="prefetch" href="/CellReport/assets/js/16.47e1d84d.js"><link rel="prefetch" href="/CellReport/assets/js/17.84d2bcfd.js"><link rel="prefetch" href="/CellReport/assets/js/18.c22e76e6.js"><link rel="prefetch" href="/CellReport/assets/js/19.e4a8ac17.js"><link rel="prefetch" href="/CellReport/assets/js/20.baf0c4ba.js"><link rel="prefetch" href="/CellReport/assets/js/21.cd325d47.js"><link rel="prefetch" href="/CellReport/assets/js/22.880f82ad.js"><link rel="prefetch" href="/CellReport/assets/js/23.b63c4e28.js"><link rel="prefetch" href="/CellReport/assets/js/24.1722f890.js"><link rel="prefetch" href="/CellReport/assets/js/25.85b2b938.js"><link rel="prefetch" href="/CellReport/assets/js/26.defdec6f.js"><link rel="prefetch" href="/CellReport/assets/js/27.b7b7b7ce.js"><link rel="prefetch" href="/CellReport/assets/js/28.a3fd976c.js"><link rel="prefetch" href="/CellReport/assets/js/29.ef58409b.js"><link rel="prefetch" href="/CellReport/assets/js/3.e0409163.js"><link rel="prefetch" href="/CellReport/assets/js/31.e3fef10c.js"><link rel="prefetch" href="/CellReport/assets/js/32.f12af479.js"><link rel="prefetch" href="/CellReport/assets/js/33.79da49dc.js"><link rel="prefetch" href="/CellReport/assets/js/4.0471e9ae.js"><link rel="prefetch" href="/CellReport/assets/js/5.77cb77cb.js"><link rel="prefetch" href="/CellReport/assets/js/6.39fa6f7e.js"><link rel="prefetch" href="/CellReport/assets/js/7.207e79d8.js"><link rel="prefetch" href="/CellReport/assets/js/vendors~docsearch.a43fb3db.js">
    <link rel="stylesheet" href="/CellReport/assets/css/0.styles.91d50dc1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/CellReport/" class="home-link router-link-active"><!----> <span class="site-name">CellReport</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/CellReport/" class="nav-link">
  简介
</a></div><div class="nav-item"><a href="/CellReport/zh/guide/" class="nav-link router-link-active">
  指南
</a></div><div class="nav-item"><a href="/CellReport/zh/conf/" class="nav-link">
  配置
</a></div><div class="nav-item"><a href="https://github.com/NoneDay/CellReport" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/CellReport/" class="nav-link">
  简介
</a></div><div class="nav-item"><a href="/CellReport/zh/guide/" class="nav-link router-link-active">
  指南
</a></div><div class="nav-item"><a href="/CellReport/zh/conf/" class="nav-link">
  配置
</a></div><div class="nav-item"><a href="https://github.com/NoneDay/CellReport" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>指南</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/CellReport/zh/guide/" aria-current="page" class="sidebar-link">介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/#它是如何工作的" class="sidebar-link">它是如何工作的？</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/#为什么不是" class="sidebar-link">为什么不是 ...?</a></li></ul></li><li><a href="/CellReport/zh/guide/getting-started.html" class="sidebar-link">快速上手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/getting-started.html#依赖环境" class="sidebar-link">依赖环境</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/getting-started.html#安装编译好的版本" class="sidebar-link">安装编译好的版本</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/getting-started.html#全手工构建" class="sidebar-link">全手工构建</a></li></ul></li><li><a href="/CellReport/zh/guide/dataset-param.html" class="sidebar-link">sql数据集和参数定义</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/dataset-param.html#sql-数据集" class="sidebar-link">sql 数据集</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/dataset-param.html#参数定义" class="sidebar-link">参数定义</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/dataset-param.html#级联参数的设置" class="sidebar-link">级联参数的设置</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/dataset-param.html#可多选下拉参数注意事项" class="sidebar-link">可多选下拉参数注意事项</a></li></ul></li><li><a href="/CellReport/zh/guide/cell-prop.html" class="sidebar-link">单元格基本属性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/cell-prop.html#值表达式" class="sidebar-link">值表达式</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/cell-prop.html#显示值表达式" class="sidebar-link">显示值表达式</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/cell-prop.html#字体颜色和背景颜色" class="sidebar-link">字体颜色和背景颜色</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/cell-prop.html#报表的钻取、跳转" class="sidebar-link">报表的钻取、跳转</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/cell-prop.html#排序" class="sidebar-link">排序</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/cell-prop.html#扩展方向、左顶格、上顶格" class="sidebar-link">扩展方向、左顶格、上顶格</a></li></ul></li><li><a href="/CellReport/zh/guide/create-report.html" class="sidebar-link">报表制作解答</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/create-report.html#输入公式" class="sidebar-link">输入公式</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/create-report.html#如何得到一个汇总行" class="sidebar-link">如何得到一个汇总行</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/create-report.html#如何定时刷新报表或数据集" class="sidebar-link">如何定时刷新报表或数据集</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/create-report.html#如何升级报表程序并使我以前的设置能保留" class="sidebar-link">如何升级报表程序并使我以前的设置能保留</a></li></ul></li><li><a href="/CellReport/zh/guide/other-dataset.html" class="sidebar-link">更多的数据集类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/other-dataset.html#来自其他数据集" class="sidebar-link">来自其他数据集</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/other-dataset.html#来自于excel文件" class="sidebar-link">来自于excel文件</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/other-dataset.html#来自api调用" class="sidebar-link">来自API调用</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/other-dataset.html#来自组件报表" class="sidebar-link">来自组件报表</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/other-dataset.html#内存数据-sqlite" class="sidebar-link">内存数据(sqlite)</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/other-dataset.html#来自html的table" class="sidebar-link">来自html的table</a></li></ul></li><li><a href="/CellReport/zh/guide/lang.html" class="sidebar-link">内置语言</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/lang.html#基础数据类型" class="sidebar-link">基础数据类型</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/lang.html#基础运算" class="sidebar-link">基础运算</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/lang.html#后端linq" class="sidebar-link">后端linq</a></li></ul></li><li><a href="/CellReport/zh/guide/function.html" aria-current="page" class="active sidebar-link">内置函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/function.html#数据集函数" class="sidebar-link">数据集函数</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/function.html#集合函数" class="sidebar-link">集合函数</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/function.html#集合运算后可接函数" class="sidebar-link">集合运算后可接函数</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/function.html#单元格函数" class="sidebar-link">单元格函数</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/function.html#日期函数" class="sidebar-link">日期函数</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/function.html#字符串函数" class="sidebar-link">字符串函数</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="内置函数"><a href="#内置函数" class="header-anchor">#</a> 内置函数</h1> <h2 id="数据集函数"><a href="#数据集函数" class="header-anchor">#</a> 数据集函数</h2> <h3 id="group-分组"><a href="#group-分组" class="header-anchor">#</a> group 分组</h3> <p>函数说明：
根据分组表达式，从数据集中选出符合过滤条件的一组组集。</p> <div class="language- extra-class"><pre class="language-text"><code>    datasetName.group( select_exp,[filter_exp] )
      参数说明：
      select_exp：	选出的分组表达式，可以是字段列名。
      当然也可以是表达式
      filter_exp: 	数据过滤表达式。

      函数示例：
      ds1.group( ds1.name )
      从数据源ds1中选取name字段，并按照name列进行分组，取出每一组第一条记
      录的name字段的值, 不排序

      ds1.group( ds1.name,ds1.sex=='1').asc()
      从数据源ds1中选取性别为男性的name字段列的值并升序排列，然后按照name
      字段进行分组，取出每一组第一条记录的name字段的值

      ds1.group( ds1.name, ds1.sex=='1').desc(ds1.id)
      从数据源ds1中选取性别为男性的name字段列的值并按id字段降序排列

      返回值：
      一组数据的集合，该集合供子格计算的时候使用
</code></pre></div><h3 id="select-清单"><a href="#select-清单" class="header-anchor">#</a> select 清单</h3> <p>类似sql语句中的select，返回指定数据集的行集。每一行的值是selcet_expr的计算结果.</p> <div class="language- extra-class"><pre class="language-text"><code>ds.select(select_expr[,cond_expr])

ds1.select(ds1.first_name + ds1.last_name)

返回值：
      一组数据的集合，该集合供子格计算的时候使用
</code></pre></div><h3 id="唯一值计数-distinct-count"><a href="#唯一值计数-distinct-count" class="header-anchor">#</a> 唯一值计数 distinct_count</h3> <div class="language- extra-class"><pre class="language-text"><code> distinct_count(select_expr[,cond_expr])
</code></pre></div><h3 id="求和-sum"><a href="#求和-sum" class="header-anchor">#</a> 求和 sum</h3> <div class="language- extra-class"><pre class="language-text"><code>datasetName.sum( select_exp,[filter_exp] )
    ds.sum(被累加的表达式，条件)
    满足条件的数据集中的被累加的表达式的求和
    
    根据左顶格和上顶格所拥有的数据集的交集，计算当前单元格的值。下同，不再说明
</code></pre></div><h3 id="最大值-max"><a href="#最大值-max" class="header-anchor">#</a> 最大值 max</h3> <div class="language- extra-class"><pre><code>ds.max( select_exp,[filter_exp] )
ds.sum(被计算的表达式，条件)
满足条件的数据集中的被累加的表达式的求最大
</code></pre></div><h3 id="datasetname-min-select-exp-filter-exp"><a href="#datasetname-min-select-exp-filter-exp" class="header-anchor">#</a> datasetName.min( select_exp,[filter_exp] )</h3> <div class="language- extra-class"><pre><code>  ds.min(被计算的表达式，条件)
  满足条件的数据集中的被累加的表达式的求最小
</code></pre></div><h3 id="datasetname-avg-select-exp-filter-exp"><a href="#datasetname-avg-select-exp-filter-exp" class="header-anchor">#</a> datasetName.avg( select_exp,[filter_exp] )</h3> <div class="language- extra-class"><pre><code>  ds.avg(被计算的表达式，条件)
  满足条件的数据集中的被累加的表达式的求平均
</code></pre></div><h3 id="datasetname-select1-select-exp-filter-exp"><a href="#datasetname-select1-select-exp-filter-exp" class="header-anchor">#</a> datasetName.select1( select_exp,[filter_exp] )</h3> <div class="language- extra-class"><pre><code>当前分组中符合条件的第一条数据
</code></pre></div><h3 id="datasetname-colcount"><a href="#datasetname-colcount" class="header-anchor">#</a> datasetName.colcount()</h3> <div class="language- extra-class"><pre><code>函数说明：
数据集的列数
语法：
datasetName.cols()
</code></pre></div><h3 id="datasetname-count-filter-exp"><a href="#datasetname-count-filter-exp" class="header-anchor">#</a> datasetName.count(filter_exp)</h3> <div class="language- extra-class"><pre><code>  ds.count(条件)
  满足条件的数据集中的个数
</code></pre></div><h3 id="datasetname-colname-col-pos"><a href="#datasetname-colname-col-pos" class="header-anchor">#</a> datasetName.colName(col_pos)</h3> <div class="language- extra-class"><pre><code>  数据集的第col_pos列的名字
</code></pre></div><h3 id="datasetname-valueforcolname"><a href="#datasetname-valueforcolname" class="header-anchor">#</a> datasetName.valueForColName()</h3> <div class="language- extra-class"><pre><code>  函数说明：
  取数据集的列
  datasetName.valueForColName( stringExp )
  datasetName.valueForColName( intExp )
  参数说明：
  stringExp 	返回数据集列名的表达式
  intExp		返回数据集列号的表达式
</code></pre></div><h3 id="getdatasourcename"><a href="#getdatasourcename" class="header-anchor">#</a> getDataSourceName()</h3> <div class="language- extra-class"><pre><code>  函数说明：
  取数据集的的数据源名称
  语法：
  datasetName.getDataSourceName( )
</code></pre></div><h2 id="集合函数"><a href="#集合函数" class="header-anchor">#</a> 集合函数</h2> <div class="custom-block tip"><p class="custom-block-title">提示</p> <div class="language- extra-class"><pre><code>计算统计报表的时候，最常用的函数
数据集的group、select以及下面列出的所有集合函数后可以跟：
//.where(expr) 条件判断 ,通常用不到这个函数
//.asc(expr) 升序 不跟参数的时候，就是以当前值做排序
//.desc(expr) 降序 不跟参数的时候，就是以当前值做排序
//例如:
ds.group(ds.key).asc()

union_set(ds.group(ds.key),
    ds2.group(ds2.key))
.asc()
</code></pre></div></div> <h3 id="并集-union-set"><a href="#并集-union-set" class="header-anchor">#</a> 并集 union_set</h3> <div class="language- extra-class"><pre><code>  使用方法：union_set([ds.group(ds.key)]+ )
  对各分组集合的ds.key求并集
</code></pre></div><ul><li><strong>可以对任意多的分组做并集。</strong></li> <li>该函数应用在多数据集的报表中，能够极大的加快报表的开发速度。在数据集做完归并后，相应的子单元格都可以正确引用到归并后的各个数据集中的数据。</li> <li>举例：<code>union_set(ds1.group(ds1.id),ds2,group(ds2.id))</code>
ds1数据集分组后的数据为:</li></ul> <table><thead><tr><th>id</th></tr></thead> <tbody><tr><td>1</td></tr> <tr><td>2</td></tr></tbody></table> <p>ds2数据集分组后的数据为:</p> <table><thead><tr><th>id</th></tr></thead> <tbody><tr><td>2</td></tr> <tr><td>3</td></tr></tbody></table> <p>这两个集合的并集为：<code>1，2，3</code>
在某单元格使用该函数后，报表运算后，从该单元格扩展出3个单元格。</p> <table><thead><tr><th>单元格行号</th> <th>对应的Ds1的数据分组</th> <th>对应的Ds2的数据分组</th> <th>子格运算公式	运算结果</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td> <td>=ds1.id+ds2.id</td></tr> <tr><td>1</td> <td>1</td> <td>空</td> <td>1</td></tr> <tr><td>2</td> <td>2</td> <td>2</td> <td>4</td></tr> <tr><td>3</td> <td>空</td> <td>3</td> <td>3</td></tr></tbody></table> <h3 id="交集-intersection-set"><a href="#交集-intersection-set" class="header-anchor">#</a> 交集 intersection_set</h3> <div class="language- extra-class"><pre><code>  使用方法：intersection_set([ds.group(ds.key)]+, (sort)? )
  对各分组集合的ds.key求交集
</code></pre></div><h3 id="差集-subtract-set"><a href="#差集-subtract-set" class="header-anchor">#</a> 差集 subtract_set</h3> <div class="language- extra-class"><pre><code>  使用方法：subtract_set([ds.group(ds.key)]+, (sort)? )
  以第一个分组为主集合，减去其他各集合的元素
</code></pre></div><h3 id="左外连接-leftjoin-set"><a href="#左外连接-leftjoin-set" class="header-anchor">#</a> 左外连接 leftJoin_set</h3> <div class="language- extra-class"><pre><code>  leftJoin_set([ds.group(ds.key)]+, (sort)? )
  以第一个分组为主集合，将后续集合按关键字合并。这个函数将会完全保留主数据集中的所有数据，不管关键字是否重复。
  其他集合函数
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>除了leftJoin_set，其他集合函数都要保证每个数据集的计算结果是唯一的。只有leftJoin_set 的第一个主数据集的计算结果可以不唯一。其他集合的数据集计算如果使用select，需要自行保证计算结果唯一，否则最终结果在做完集合运算后可能不正确。</p></div> <h2 id="集合运算后可接函数"><a href="#集合运算后可接函数" class="header-anchor">#</a> 集合运算后可接函数</h2> <h3 id="asc"><a href="#asc" class="header-anchor">#</a> asc()</h3> <p>对已经生成的列表做升序计算。如果没有参数，将按集合元素的value计算顺序，有参数就按参数计算结果计算顺序</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token operator">=</span><span class="token function">union_set</span><span class="token punctuation">(</span>ds1<span class="token punctuation">.</span><span class="token keyword">group</span><span class="token punctuation">(</span>ds1<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span>ds2<span class="token punctuation">.</span><span class="token keyword">group</span><span class="token punctuation">(</span>ds2<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">=</span>ds1<span class="token punctuation">.</span><span class="token keyword">group</span><span class="token punctuation">(</span>ds1<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="desc"><a href="#desc" class="header-anchor">#</a> desc()</h3> <p>对已经生成的列表做降序计算</p> <h3 id="where"><a href="#where" class="header-anchor">#</a> where()</h3> <p>对已经生成的列表做降序计算</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token operator">=</span><span class="token function">union_set</span><span class="token punctuation">(</span>ds1<span class="token punctuation">.</span><span class="token keyword">group</span><span class="token punctuation">(</span>ds1<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span>ds2<span class="token punctuation">.</span><span class="token keyword">group</span><span class="token punctuation">(</span>ds2<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">where</span><span class="token punctuation">(</span>ds1<span class="token punctuation">.</span>xx<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">=</span>ds1<span class="token punctuation">.</span><span class="token keyword">group</span><span class="token punctuation">(</span>ds1<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">where</span><span class="token punctuation">(</span>@<span class="token keyword">value</span><span class="token operator">&gt;</span><span class="token number">100</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="to-dict"><a href="#to-dict" class="header-anchor">#</a> to_dict()</h3> <p>将当前生成的列表转换为字典，主键为元素的值
主要使用在自定义函数中，对数据集做进一步计算。如查找</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> ds_dict<span class="token punctuation">;</span><span class="token comment">//定义一个全局变量</span>
<span class="token comment">//在所有数据集取数结束，计算报表的单元格前，将会自动调用这个函数</span>
<span class="token keyword">function</span> <span class="token function">_after_calc_dataset_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   ds_dict<span class="token operator">=</span>ds<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>ds<span class="token punctuation">.</span>订单<span class="token constant">ID</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//字典的key是订单ID，value是group,group.rows是所有订单ID相同的行组成的列表</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">订单ID_count</span><span class="token punctuation">(</span><span class="token parameter">订单<span class="token constant">ID</span><span class="token punctuation">,</span>rowno</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> _yc<span class="token operator">=</span>ds_dict<span class="token punctuation">[</span>订单<span class="token constant">ID</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
  <span class="token keyword">if</span><span class="token punctuation">(</span>_yc<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token comment">//查找`订单ID`对应的group对应有多少条数据</span>
  <span class="token keyword">return</span> _yc<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 也可以加条件，注意条件里面的数据集名称要和 函数前的一样。_yc.count(_yc.rowno&lt;=rowno);</span>
  <span class="token comment">//                                                    ^          ^</span>

  <span class="token comment">//下面是类似sql中的row_number功能的实现。rowno是原始数据中存放的行号，通过判断行号是否相等来判断是否是同一条数据</span>
  <span class="token comment">//当然这样的实现很丑陋，但这仅仅是一个功能演示。_yc.count(_yc.rowno&lt;=rowno)也可以实现类似功能</span>
  <span class="token keyword">var</span> idx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> t <span class="token keyword">in</span> _yc<span class="token punctuation">)</span><span class="token punctuation">{</span>
    idx<span class="token operator">=</span>idx<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>rowno<span class="token operator">==</span>rowno<span class="token punctuation">)</span>
  	  <span class="token keyword">return</span> idx<span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>做好预定义后，我们可以在单元格中引用该函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">=</span><span class="token function">订单ID_count</span><span class="token punctuation">(</span>ds<span class="token punctuation">.</span>订单<span class="token constant">ID</span><span class="token punctuation">)</span><span class="token comment">//计算某个订单号有几条记录</span>
</code></pre></div><h2 id="单元格函数"><a href="#单元格函数" class="header-anchor">#</a> 单元格函数</h2> <h3 id="ifempty"><a href="#ifempty" class="header-anchor">#</a> ifEmpty(,)</h3> <div class="language- extra-class"><pre><code>  函数说明：
  从前往后，参数如果不为null或空字符串，就返回当前参数值，如果都是为空，就返回&quot;&quot;
  语法：
  ifEmpty(ValueExp1, ValueExp2,..... )
</code></pre></div><h3 id="iif"><a href="#iif" class="header-anchor">#</a> iif(,,)</h3> <div class="language- extra-class"><pre><code>  函数说明：
  根据布尔表达式的不同结果，返回不同的值
  语法：
  iif( (条件, 结果,)+,falseValueExp)
  ***条件结果对*** 可以无限多，找到的第一个条件成立时，返回紧跟其后的结果

例子：iif（param.xxx=='1','x1',param.yyy==2,'x2','x3')
  解释：当param.xxx==1时,返回 'x1'，param.yyy==2时，返回 'x2'，否则返回'x3'
  优先判断前面的条件
</code></pre></div><h3 id="sum-expr"><a href="#sum-expr" class="header-anchor">#</a> sum(expr)</h3> <div class="language- extra-class"><pre><code>如果参数是集合类型，将对其做累加，其他类型不计算，直接返回
</code></pre></div><h3 id="max-expr"><a href="#max-expr" class="header-anchor">#</a> max(expr)</h3> <div class="language- extra-class"><pre><code>如果参数是集合类型，将对其计算最大值，其他类型不计算，直接返回
</code></pre></div><h3 id="min-expr"><a href="#min-expr" class="header-anchor">#</a> min(expr)</h3> <div class="language- extra-class"><pre><code>如果参数是集合类型，将对其计算最小值，其他类型不计算，直接返回
</code></pre></div><h3 id="avg-expr"><a href="#avg-expr" class="header-anchor">#</a> avg(expr)</h3> <div class="language- extra-class"><pre><code>如果参数是集合类型，将对其做累加后计算平均值，其他类型不计算，直接返回
</code></pre></div><h3 id="desc-rank"><a href="#desc-rank" class="header-anchor">#</a> desc_rank()</h3> <div class="language- extra-class"><pre><code>参数必须是单元格名称，现在只对只有一个行扩展的情况有效。
按降序排名。 数字最大的是第一名。 参数填对应单元格。如：第1名有2个重复，下一个名次是3
</code></pre></div><h3 id="asc-rank"><a href="#asc-rank" class="header-anchor">#</a> asc_rank()</h3> <div class="language- extra-class"><pre><code>参数必须是单元格名称，现在只对只有一个行扩展的情况有效。
按升序排名。数字小大的是第一名。参数填对应单元格。如：第1名有2个重复，下一个名次是3 
</code></pre></div><h3 id="desc-dense-rank"><a href="#desc-dense-rank" class="header-anchor">#</a> desc_dense_rank()</h3> <div class="language- extra-class"><pre><code>参数必须是单元格名称，现在只对只有一个行扩展的情况有效。
按降序做密集排名。数字最大的是第一名。参数填对应单元格。如：第1名有两个重复，下一个名次是2 
</code></pre></div><h3 id="asc-dense-rank"><a href="#asc-dense-rank" class="header-anchor">#</a> asc_dense_rank()</h3> <div class="language- extra-class"><pre><code>参数必须是单元格名称，现在只对只有一个行扩展的情况有效。
按降序做密集排名。数字最小的是第一名。参数填对应单元格。 名次是连续的，如：第1名有两个重复，下一个名次是2  
</code></pre></div><h3 id="fromto"><a href="#fromto" class="header-anchor">#</a> fromto(,)</h3> <div class="language- extra-class"><pre><code>fromto(开始值，结束值，步长）
如：fromto(1,20) 缺省步长为1
fromto(1,20,2)
通常我们在计算补齐数据的时候使用它作为数据集来计算连续数据，从而达到补齐效果
</code></pre></div><h3 id="row"><a href="#row" class="header-anchor">#</a> row()</h3> <div class="language- extra-class"><pre><code>函数说明：
取得当前格所有行的行号
</code></pre></div><h3 id="col"><a href="#col" class="header-anchor">#</a> col()</h3> <div class="language- extra-class"><pre><code>函数说明：
取得当前单元格所在列的列号
</code></pre></div><h3 id="cellcolname"><a href="#cellcolname" class="header-anchor">#</a> cellColName()</h3> <div class="language- extra-class"><pre><code>  函数说明：
  取得当前单元格所在列的列名
  语法：
  cellColName()
</code></pre></div><h3 id="query"><a href="#query" class="header-anchor">#</a> query(,)</h3> <div class="language- extra-class"><pre><code>  query(数据库连接名字,sql语句)
</code></pre></div><h3 id="range-count"><a href="#range-count" class="header-anchor">#</a> range_count(,)</h3> <div class="language- extra-class"><pre><code>  range_count(单元格列表,值1,是否相等,值2,是否相等)
  单元格列表中 大于值1 小于 值2的有多少个
  是否相等：缺省为相等
</code></pre></div><h3 id="vaule"><a href="#vaule" class="header-anchor">#</a> @vaule</h3> <div class="language- extra-class"><pre><code>本单元格的实际值
</code></pre></div><h3 id="floor"><a href="#floor" class="header-anchor">#</a> floor()</h3> <div class="language- extra-class"><pre><code>  取带小数点的数字的地板值
  floor(3.5)=4
</code></pre></div><h3 id="ceiling"><a href="#ceiling" class="header-anchor">#</a> ceiling()</h3> <div class="language- extra-class"><pre><code>  取带小数点的数字的天板值
  ceiling(3.5)=3
</code></pre></div><h2 id="日期函数"><a href="#日期函数" class="header-anchor">#</a> 日期函数</h2> <h3 id="date"><a href="#date" class="header-anchor">#</a> date(,,)</h3> <div class="language- extra-class"><pre><code>  使用方法：date(year,month,day)
  例如 date(2021,12,1) 结果就是2021年12月1日
</code></pre></div><h3 id="adddays"><a href="#adddays" class="header-anchor">#</a> .AddDays()</h3> <div class="language- extra-class"><pre><code>  必须是日期型变量才能使用
  使用方法：date(2014,1,2).AddDays(-1)
  结果：2014-1-1
</code></pre></div><h3 id="addmonths"><a href="#addmonths" class="header-anchor">#</a> .AddMonths()</h3> <div class="language- extra-class"><pre><code>  必须是日期型变量才能使用
  使用方法：date(2014,2,2).AddMonths(-1)
  结果：2014-1-2
</code></pre></div><h3 id="addyears"><a href="#addyears" class="header-anchor">#</a> .AddYears()</h3> <div class="language- extra-class"><pre><code>  必须是日期型变量才能使用
  使用方法：date(2014,2,2).AddYears(-1)
  结果：2013-2-2
</code></pre></div><h3 id="today"><a href="#today" class="header-anchor">#</a> today()</h3> <p>当天</p> <h3 id="prevday"><a href="#prevday" class="header-anchor">#</a> prevDay()</h3> <p>昨天<br> <strong>以下函数如果没有参数，就是以当前日期计算，有的话就是按指定日期开始计算</strong></p> <h3 id="firstdayofyear"><a href="#firstdayofyear" class="header-anchor">#</a> firstDayOfYear()</h3> <p>指定日期的当年第一天</p> <h3 id="prevmonth"><a href="#prevmonth" class="header-anchor">#</a> prevMonth()</h3> <p>上月同一天</p> <h3 id="prevyear"><a href="#prevyear" class="header-anchor">#</a> prevYear()</h3> <p>上年同一天</p> <h3 id="quaterend"><a href="#quaterend" class="header-anchor">#</a> quaterEnd()</h3> <p>本季度最后一天</p> <h3 id="quaterbegin"><a href="#quaterbegin" class="header-anchor">#</a> quaterBegin()</h3> <div class="language- extra-class"><pre><code>本季度第一天   
</code></pre></div><h3 id="monthend"><a href="#monthend" class="header-anchor">#</a> monthEnd()</h3> <p>本月最后一天</p> <h3 id="monthbegin"><a href="#monthbegin" class="header-anchor">#</a> monthBegin()</h3> <p>本月第一天</p> <h3 id="weekbegin"><a href="#weekbegin" class="header-anchor">#</a> weekBegin()</h3> <p>本周第一天</p> <h3 id="weekend"><a href="#weekend" class="header-anchor">#</a> weekEnd()</h3> <p>本周最后一天</p> <h3 id="weeknum"><a href="#weeknum" class="header-anchor">#</a> weekNum()</h3> <p>星期几</p> <h3 id="year"><a href="#year" class="header-anchor">#</a> year()</h3> <p>年</p> <h3 id="quater"><a href="#quater" class="header-anchor">#</a> quater()</h3> <p>季度</p> <h3 id="month"><a href="#month" class="header-anchor">#</a> month()</h3> <p>月</p> <h3 id="dayofyear"><a href="#dayofyear" class="header-anchor">#</a> dayOfYear()</h3> <p>本年的几天</p> <h3 id="dayofmonth"><a href="#dayofmonth" class="header-anchor">#</a> dayOfMonth()</h3> <p>本月的几天</p> <h3 id="hour"><a href="#hour" class="header-anchor">#</a> hour()</h3> <p>24小时制的小时</p> <h3 id="minute"><a href="#minute" class="header-anchor">#</a> minute()</h3> <p>分钟</p> <h3 id="second"><a href="#second" class="header-anchor">#</a> second()</h3> <p>秒</p> <h3 id="formatdatetime"><a href="#formatdatetime" class="header-anchor">#</a> formatDatetime()</h3> <div class="language- extra-class"><pre><code>格式化日期
G 年代标志符   y 年   M 月   d 日
h 时 在上午或下午 (1~12)   H 时 在一天中 (0~23)
m 分   s 秒   S 毫秒   E 星期   D 一年中的第几天
F 一月中第几个星期几   w 一年中第几个星期   W 一月中第几个星期
a 上午 / 下午 标记符   k 时 在一天中 (1~24)
K 时 在上午或下午 (0~11)
z 时区

缺省格式为：yyyy-MM-dd
如果第一个参数不是日期类型，那么将使用缺省格式分析该字符串，将之装换为日期后再格式化
举例：formatDatetime('2007-01-01','yyyy年MM月dd日HH时mm分ss秒')
formatDatetime('2007-01-01')
</code></pre></div><h2 id="字符串函数"><a href="#字符串函数" class="header-anchor">#</a> 字符串函数</h2> <h3 id="replacestr"><a href="#replacestr" class="header-anchor">#</a> replaceStr(,,)</h3> <div class="language- extra-class"><pre><code>  query(源字符串,被替换字符串,替换字符串)
</code></pre></div><h3 id="substring"><a href="#substring" class="header-anchor">#</a> substring(,,)</h3> <div class="language- extra-class"><pre><code>  substring(源字符串,开始位置,结束位置)
</code></pre></div><h3 id="length"><a href="#length" class="header-anchor">#</a> length()</h3> <div class="language- extra-class"><pre><code>  length(字符串) 字符串长度
</code></pre></div><h3 id="indexof"><a href="#indexof" class="header-anchor">#</a> indexof(,,)</h3> <div class="language- extra-class"><pre><code>  indexof(目标字符串,被查找字符串,(开始查找的位置)?)
</code></pre></div><h3 id="isempty"><a href="#isempty" class="header-anchor">#</a> isEmpty()</h3> <div class="language- extra-class"><pre><code>  isEmpty(目标)
  如果目标为NULL返回true
  如果不是字符串,做toString()后作为字符串判断
  如果是字符串，且等于&quot;&quot;,返回true
</code></pre></div><h3 id="formatnumber"><a href="#formatnumber" class="header-anchor">#</a> formatNumber()</h3> <div class="language- extra-class"><pre><code>  格式化数字。
  缺省格式：###########0.##
  如： formatNumber(1234.567) 输出为 1234.57
  如要指定格式，在第二个参数写格式。
  如：formatNumber(1234,567,&quot;#####.0000&quot;)输出为：1234.5670
</code></pre></div><h3 id="split"><a href="#split" class="header-anchor">#</a> split()</h3> <div class="language- extra-class"><pre><code>  分割字符串
  split(源字符串,分割符)
  split(&quot;123,456,789&quot;, &quot;,&quot;)输出为：[&quot;123&quot; ,&quot;456&quot;,&quot;479&quot;], 一个数组列表
</code></pre></div><h3 id="json-parse"><a href="#json-parse" class="header-anchor">#</a> json_parse</h3> <div class="language- extra-class"><pre><code> 类似js中的JSON.parse 。将字符串解析为对象
json_parse('[{&quot;a&quot;:1},{&quot;a&quot;:2}]') 
</code></pre></div><h3 id="json-stringify"><a href="#json-stringify" class="header-anchor">#</a> json_stringify</h3> <div class="language- extra-class"><pre><code>  类似js中的JSON.stringify，将对象转换为json字符串
  json_stringify([{&quot;a&quot;:1},{&quot;a&quot;:2}])</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/NoneDay/CellReport/edit/master/docs/zh/guide/function.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">10/10/2022, 7:50:56 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/CellReport/zh/guide/lang.html" class="prev">
        内置语言
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/CellReport/assets/js/app.17a3e785.js" defer></script><script src="/CellReport/assets/js/2.5bae9e2d.js" defer></script><script src="/CellReport/assets/js/1.6b473380.js" defer></script><script src="/CellReport/assets/js/30.ae59d942.js" defer></script>
  </body>
</html>
