<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>sql数据集和参数定义 | CellReport</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/CellReport/logo.jpg">
    <meta name="description" content="我的个人网站">
    
    <link rel="preload" href="/CellReport/assets/css/0.styles.91d50dc1.css" as="style"><link rel="preload" href="/CellReport/assets/js/app.17a3e785.js" as="script"><link rel="preload" href="/CellReport/assets/js/2.5bae9e2d.js" as="script"><link rel="preload" href="/CellReport/assets/js/1.6b473380.js" as="script"><link rel="preload" href="/CellReport/assets/js/29.ef58409b.js" as="script"><link rel="prefetch" href="/CellReport/assets/js/10.5d0c9869.js"><link rel="prefetch" href="/CellReport/assets/js/11.ed9759c5.js"><link rel="prefetch" href="/CellReport/assets/js/12.13686169.js"><link rel="prefetch" href="/CellReport/assets/js/13.58661524.js"><link rel="prefetch" href="/CellReport/assets/js/14.0ca0c540.js"><link rel="prefetch" href="/CellReport/assets/js/15.3eee5f97.js"><link rel="prefetch" href="/CellReport/assets/js/16.47e1d84d.js"><link rel="prefetch" href="/CellReport/assets/js/17.84d2bcfd.js"><link rel="prefetch" href="/CellReport/assets/js/18.c22e76e6.js"><link rel="prefetch" href="/CellReport/assets/js/19.e4a8ac17.js"><link rel="prefetch" href="/CellReport/assets/js/20.baf0c4ba.js"><link rel="prefetch" href="/CellReport/assets/js/21.cd325d47.js"><link rel="prefetch" href="/CellReport/assets/js/22.880f82ad.js"><link rel="prefetch" href="/CellReport/assets/js/23.b63c4e28.js"><link rel="prefetch" href="/CellReport/assets/js/24.1722f890.js"><link rel="prefetch" href="/CellReport/assets/js/25.85b2b938.js"><link rel="prefetch" href="/CellReport/assets/js/26.defdec6f.js"><link rel="prefetch" href="/CellReport/assets/js/27.b7b7b7ce.js"><link rel="prefetch" href="/CellReport/assets/js/28.a3fd976c.js"><link rel="prefetch" href="/CellReport/assets/js/3.e0409163.js"><link rel="prefetch" href="/CellReport/assets/js/30.ae59d942.js"><link rel="prefetch" href="/CellReport/assets/js/31.e3fef10c.js"><link rel="prefetch" href="/CellReport/assets/js/32.f12af479.js"><link rel="prefetch" href="/CellReport/assets/js/33.79da49dc.js"><link rel="prefetch" href="/CellReport/assets/js/4.0471e9ae.js"><link rel="prefetch" href="/CellReport/assets/js/5.77cb77cb.js"><link rel="prefetch" href="/CellReport/assets/js/6.39fa6f7e.js"><link rel="prefetch" href="/CellReport/assets/js/7.207e79d8.js"><link rel="prefetch" href="/CellReport/assets/js/vendors~docsearch.a43fb3db.js">
    <link rel="stylesheet" href="/CellReport/assets/css/0.styles.91d50dc1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/CellReport/" class="home-link router-link-active"><!----> <span class="site-name">CellReport</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/CellReport/" class="nav-link">
  简介
</a></div><div class="nav-item"><a href="/CellReport/zh/guide/" class="nav-link router-link-active">
  指南
</a></div><div class="nav-item"><a href="/CellReport/zh/conf/" class="nav-link">
  配置
</a></div><div class="nav-item"><a href="https://github.com/NoneDay/CellReport" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/CellReport/" class="nav-link">
  简介
</a></div><div class="nav-item"><a href="/CellReport/zh/guide/" class="nav-link router-link-active">
  指南
</a></div><div class="nav-item"><a href="/CellReport/zh/conf/" class="nav-link">
  配置
</a></div><div class="nav-item"><a href="https://github.com/NoneDay/CellReport" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>指南</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/CellReport/zh/guide/" aria-current="page" class="sidebar-link">介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/#它是如何工作的" class="sidebar-link">它是如何工作的？</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/#为什么不是" class="sidebar-link">为什么不是 ...?</a></li></ul></li><li><a href="/CellReport/zh/guide/getting-started.html" class="sidebar-link">快速上手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/getting-started.html#依赖环境" class="sidebar-link">依赖环境</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/getting-started.html#安装编译好的版本" class="sidebar-link">安装编译好的版本</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/getting-started.html#全手工构建" class="sidebar-link">全手工构建</a></li></ul></li><li><a href="/CellReport/zh/guide/dataset-param.html" aria-current="page" class="active sidebar-link">sql数据集和参数定义</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/dataset-param.html#sql-数据集" class="sidebar-link">sql 数据集</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/dataset-param.html#参数定义" class="sidebar-link">参数定义</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/dataset-param.html#级联参数的设置" class="sidebar-link">级联参数的设置</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/dataset-param.html#可多选下拉参数注意事项" class="sidebar-link">可多选下拉参数注意事项</a></li></ul></li><li><a href="/CellReport/zh/guide/cell-prop.html" class="sidebar-link">单元格基本属性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/cell-prop.html#值表达式" class="sidebar-link">值表达式</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/cell-prop.html#显示值表达式" class="sidebar-link">显示值表达式</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/cell-prop.html#字体颜色和背景颜色" class="sidebar-link">字体颜色和背景颜色</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/cell-prop.html#报表的钻取、跳转" class="sidebar-link">报表的钻取、跳转</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/cell-prop.html#排序" class="sidebar-link">排序</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/cell-prop.html#扩展方向、左顶格、上顶格" class="sidebar-link">扩展方向、左顶格、上顶格</a></li></ul></li><li><a href="/CellReport/zh/guide/create-report.html" class="sidebar-link">报表制作解答</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/create-report.html#输入公式" class="sidebar-link">输入公式</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/create-report.html#如何得到一个汇总行" class="sidebar-link">如何得到一个汇总行</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/create-report.html#如何定时刷新报表或数据集" class="sidebar-link">如何定时刷新报表或数据集</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/create-report.html#如何升级报表程序并使我以前的设置能保留" class="sidebar-link">如何升级报表程序并使我以前的设置能保留</a></li></ul></li><li><a href="/CellReport/zh/guide/other-dataset.html" class="sidebar-link">更多的数据集类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/other-dataset.html#来自其他数据集" class="sidebar-link">来自其他数据集</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/other-dataset.html#来自于excel文件" class="sidebar-link">来自于excel文件</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/other-dataset.html#来自api调用" class="sidebar-link">来自API调用</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/other-dataset.html#来自组件报表" class="sidebar-link">来自组件报表</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/other-dataset.html#内存数据-sqlite" class="sidebar-link">内存数据(sqlite)</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/other-dataset.html#来自html的table" class="sidebar-link">来自html的table</a></li></ul></li><li><a href="/CellReport/zh/guide/lang.html" class="sidebar-link">内置语言</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/lang.html#基础数据类型" class="sidebar-link">基础数据类型</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/lang.html#基础运算" class="sidebar-link">基础运算</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/lang.html#后端linq" class="sidebar-link">后端linq</a></li></ul></li><li><a href="/CellReport/zh/guide/function.html" class="sidebar-link">内置函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/function.html#数据集函数" class="sidebar-link">数据集函数</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/function.html#集合函数" class="sidebar-link">集合函数</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/function.html#集合运算后可接函数" class="sidebar-link">集合运算后可接函数</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/function.html#单元格函数" class="sidebar-link">单元格函数</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/function.html#日期函数" class="sidebar-link">日期函数</a></li><li class="sidebar-sub-header"><a href="/CellReport/zh/guide/function.html#字符串函数" class="sidebar-link">字符串函数</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sql数据集和参数定义"><a href="#sql数据集和参数定义" class="header-anchor">#</a> sql数据集和参数定义</h1> <h2 id="sql-数据集"><a href="#sql-数据集" class="header-anchor">#</a> sql 数据集</h2> <p><em>其他数据集类型待补充。</em></p> <p>在设计报表的数据集时，sql数据集内部使用参数可以先使用，后定义。参数以两个$包起来，插入到sql语句中。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>订单ID<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>产品ID<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>产品<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>产品名称<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>单价<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>数量<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>折扣<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>单价<span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">[</span>数量<span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token punctuation">[</span>折扣<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span> <span class="token keyword">AS</span> 总价
<span class="token keyword">FROM</span> 产品 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> 订单明细 <span class="token keyword">ON</span> <span class="token punctuation">[</span>产品<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>产品ID<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>产品ID<span class="token punctuation">]</span>
<span class="token keyword">where</span>  
 <span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>订单ID<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'$dindan$'</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>使用$$将参数包起来插入sql的方式，实际上是字符串拼接。引擎内部会自动对参数做sql注入的检测，如果检测到有危险，除非是以缺省值或可选列表值的方式提供的危险参数才可以执行，否则将不会执行，报错退出。</p></div> <p>如果参数是字符串，要注意外面的引号不要丢失</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#如果需要动态构造sql 语句，比如判断用户是否输入了某个参数，输入的话就拼接指定的sql片段</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>订单ID<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>产品ID<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>产品<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>产品名称<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>单价<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>数量<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>折扣<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>单价<span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">[</span>数量<span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token punctuation">[</span>折扣<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span> <span class="token keyword">AS</span> 总价
<span class="token keyword">FROM</span> 产品 <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> 订单明细 <span class="token keyword">ON</span> <span class="token punctuation">[</span>产品<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>产品ID<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>产品ID<span class="token punctuation">]</span>
<span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span>

$<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token operator">=</span><span class="token operator">=</span>isEmpty<span class="token punctuation">(</span>param<span class="token punctuation">.</span>dindan<span class="token punctuation">)</span><span class="token punctuation">)</span>{$
 <span class="token operator">and</span> <span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>订单ID<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'$dindan$'</span>
$}$

$<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token operator">=</span><span class="token operator">=</span>isEmpty<span class="token punctuation">(</span>param<span class="token punctuation">.</span>chanping<span class="token punctuation">)</span><span class="token punctuation">)</span>{$
<span class="token operator">and</span> <span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>产品ID<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'$chanping$'</span>
$}$

<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">[</span>订单明细<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>订单ID<span class="token punctuation">]</span>
</code></pre></div><ul><li>上面的例子，是将if 语句用$$包起来插入sql语句中，注意 语句块{、 }不要丢失，否则会报错。条件语句块结束用$}$结束</li> <li>内嵌的模板语句中（上例中的if语句）使用参数时，要用param.参数 的方式。注意区别。</li> <li>当if条件满足的时候，会将紧跟其后的语句块中字符串拼接到当前的sql 中</li></ul> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>因为这种方式是字符串拼接，所以 sql 语句的任意部分都可以插入$参数$</p></div> <p>参数绑定到sql 的时候，不管是什么数据类型，都会将参数值转换为字符串类型，然后插入到sql 的对应位置。如果参数是可以下拉选择的多选形式：</p> <ul><li>参数是数字类型的，如选中的参数是1、2、3，转换为字符串后是 :   1,2,3</li> <li>参数是字符串类型的，如选中的参数是a、b、c，转换为字符串后是 :   'a','b','c'</li></ul> <h2 id="参数定义"><a href="#参数定义" class="header-anchor">#</a> 参数定义</h2> <ul><li>参数有以下几个特征：</li></ul> <ul><li>1、参数有数据类型</li> <li>2、参数有缺省值</li> <li>3、可以定义显示查询界面时使用的可选择数据，比如某个项目代码作为参数，在定义该参数的可选参数时，可以直接指定可选数据，也可以选择从sql语句中选择显示值和实际值。</li> <li>4、参数可以定义缺省值的公式，可以引用已定义的参数，要避免参数的循环引用。</li> <li>参数类型：内部。内部参数都是延迟计算的。内部参数是不显示在查询条件中的，一般都是做为中间变量使用的。为程序控制添加了强有力的中间控制环节。</li></ul> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>在报表中所有的参数也是作为一个数据集对待，该数据集叫param，每个参数都是作为该数据集的一个字段属性出现。这样在报表单元格中引用的时候，直接使用param.xxx即可。</p></div> <ul><li><p>在参数定义界面，点按钮：载入未定义的参数，将会自动搜索sql语句中用到的参数。参数的数据类型有：数字、字符串、日期等类型。可以选择对最终页面是否隐藏该参数（html网页上form的hide类型），是否是内部（不会提供给最终用户看到和修改的机会，每次取值都是根据公式计算，相当于内部临时变量），多选（如果是可以下拉选择的时候有效）。当参数的数据类型是日期或者是隐藏、内部等方式下，参数自动不允许被多选。</p></li> <li><p>如果参数是内部类型（相当于临时变量），那么他一定是在所依赖参数的后面定义，否则报表运行的时候会报引用了没有定义的参数。通过参数列表定义界面可以拖动参数的相对位置。内部参数通常是根据非内部参数计算出来的新值。</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 假如我们已经定义了一个参数叫：b_date，我们现在需要根据这个日期参数，计算这个日期所在月的最后一天</span>
<span class="token comment">// 我们可以新增一个参数，将选项：内部 √ 上，然后设置缺省值为:</span>
<span class="token operator">=</span><span class="token function">monthEnd</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span>b_date<span class="token punctuation">)</span>
<span class="token comment">// 这样我们就可以在sql 中直接使用这个参数了。</span>
<span class="token comment">// 如果这个参数在sql中仅使用一次，我们也可以直接将这个公式内联到sql中，用以下语法:   </span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code> <span class="token comment">#注意第一个$ 后面有个+</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tbl <span class="token keyword">where</span> m_date<span class="token operator">&gt;=</span><span class="token string">'$b_date$'</span> <span class="token operator">and</span> m_date<span class="token operator">&lt;=</span><span class="token string">'$+monthEnd(param.b_date)$'</span>
</code></pre></div><ul><li>每个参数都会有缺省参数，当报表运行的时候，如果没有提供参数值，将会以缺省参数运行。</li></ul> <h2 id="级联参数的设置"><a href="#级联参数的设置" class="header-anchor">#</a> 级联参数的设置</h2> <p>假设现在报表需要两个参数，一个是产品类别id，一个是产品id，这两个参数都是可以通过下拉列表选择的。现在需要的是，客户选择的类别改变后，产品列表中的可选产品也要表示成当前类别的参数。
我们先定义类别参数，名字为<code>leibie</code>。定义从数据库取数的数据集sql，名称为：类别</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 类别<span class="token punctuation">.</span>类别ID<span class="token punctuation">,</span> 类别<span class="token punctuation">.</span>类别名称 <span class="token keyword">FROM</span> 类别
</code></pre></div><p>在参数定义画面，新建参数<code>leibie</code>。参数设置如下图：</p> <p>定义参数：<code>chanpin</code>。定义从数据库取数的数据集sql，名称为：<code>产品</code></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 产品<span class="token punctuation">.</span>产品ID<span class="token punctuation">,</span> 产品<span class="token punctuation">.</span>产品名称 <span class="token keyword">FROM</span> 产品 <span class="token keyword">where</span> 类别ID<span class="token operator">=</span>$leibie$
</code></pre></div><p>在参数定义画面，新建参数产品。参数设置如下图：
<img src="/img/param_mutil.png" alt="demo"></p> <p>数据类型为数字或字符串，非隐藏和内部类型时，可选值可以是手动录入或来自数据集。如果这两项任意一个里面有数据，将会自动出现下拉列表。这里我们都选来自于数据集。</p> <p>现在我们就已经完成了级联参数的设置。我们可以看到参数：chanpin 的可选值是从产品数据集中来的，而产品数据集依赖于参数leibie（看sql语句），所以参数chanpin就依赖于参数leibie。报表引擎会自动判断该依赖关系，从而自动生成参数的级联变动。</p> <h2 id="可多选下拉参数注意事项"><a href="#可多选下拉参数注意事项" class="header-anchor">#</a> 可多选下拉参数注意事项</h2> <p>多选参数在组装到sql 中时，会自动对字符串类似的选项加单引号和逗号，数字类型只添加逗号。通常sql 中要使用in。
缺省值不需要使用单引号。如A,B,C做为缺省值</p> <div class="language-sql extra-class"><pre class="language-sql"><code> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> xxx
 xxx <span class="token operator">in</span> <span class="token punctuation">(</span>$param_x$<span class="token punctuation">)</span>
</code></pre></div><p>如果param_x当前选中的是A,B,C，那么上面的sql 将 转换 为 :</p> <div class="language-sql extra-class"><pre class="language-sql"><code> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> xxx
 xxx <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">)</span>
</code></pre></div><p>::: tips
var _ExecSqlTimeOut_=120;  //可以调整sql 执行查询超时时间。在后端脚本里面加上
:::</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/NoneDay/CellReport/edit/master/docs/zh/guide/dataset-param.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">10/10/2022, 7:50:56 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/CellReport/zh/guide/getting-started.html" class="prev">
        快速上手
      </a></span> <span class="next"><a href="/CellReport/zh/guide/cell-prop.html">
        单元格基本属性
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/CellReport/assets/js/app.17a3e785.js" defer></script><script src="/CellReport/assets/js/2.5bae9e2d.js" defer></script><script src="/CellReport/assets/js/1.6b473380.js" defer></script><script src="/CellReport/assets/js/29.ef58409b.js" defer></script>
  </body>
</html>
